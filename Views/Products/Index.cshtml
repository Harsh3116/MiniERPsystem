@model IEnumerable<Product>
@using Microsoft.AspNetCore.Http
@using System.Linq

@{
    var userRole = Context.Session.GetString("UserRole");
}
@{
    ViewData["Title"] = "Product Inventory";
}

<h2 class="mb-3">Product Inventory</h2>
<p class="text-muted mb-4">
    Manage available products, stock levels, and pricing.
</p>

<form method="get" class="mb-3">
    <div class="input-group">
        <input type="text"
               name="searchString"
               value="@ViewBag.SearchString"
               class="form-control"
               placeholder="Search product name..." />

        <button class="btn btn-primary" type="submit">
            Search
        </button>
    </div>
</form>

<p class="d-flex gap-2">
    @if (userRole == "Admin")
    {
        <a asp-action="Create" class="btn btn-primary">
            Create New
        </a>

        <a asp-action="ExportToExcel"
           class="btn btn-success">
            Export to Excel
        </a>
    }
    else
    {
        <button class="btn btn-primary" disabled>
            Create New
        </button>
    }
</p>

<table class="table">
    <thead>
        <tr>
            <th>
                @Html.DisplayNameFor(model => model.ProductName)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Price)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.StockQuantity)
            </th>
            <th></th>
        </tr>
    </thead>
    <tbody>
@if (!Model.Any())
{
    <tr>
        <td colspan="4" class="text-center text-muted py-4">
            No products available.
                    @if (userRole == "Admin")
                    {
                        <br />
                        @:<strong>Click Create New</strong> to add your first product.
                    }

        </td>
    </tr>
}
else
{
    @foreach (var item in Model)
    {
        <tr class="@(item.StockQuantity <= 5 ? "table-danger" : "")">
            <td>@item.ProductName</td>
            <td>@item.Price</td>
            <td>
                @item.StockQuantity
                @if (item.StockQuantity <= 5)
                {
                    <span class="badge bg-danger ms-2">Low</span>
                }
            </td>
            <td>
                <!-- keep your existing action buttons here -->
            </td>
        </tr>
    }
}
</tbody>

</table>
@if (ViewBag.TotalPages > 1)
{
    <nav>
        <ul class="pagination">

            @for (int i = 1; i <= ViewBag.TotalPages; i++)
            {
                <li class="page-item @(i == ViewBag.CurrentPage ? "active" : "")">
                    <a class="page-link"
                       href="?page=@i&searchString=@ViewBag.SearchString">
                        @i
                    </a>
                </li>
            }

        </ul>
    </nav>
}
